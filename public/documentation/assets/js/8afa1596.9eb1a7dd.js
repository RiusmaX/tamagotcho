"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[986],{2609:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"cron/api-reference","title":"R\xe9f\xe9rence API","description":"Documentation technique compl\xe8te du syst\xe8me de mise \xe0 jour automatique.","source":"@site/docs/cron/api-reference.md","sourceDirName":"cron","slug":"/cron/api-reference","permalink":"/documentation/cron/api-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/RiusmaX/tamagotcho/tree/master/documentation/docs/cron/api-reference.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"R\xe9f\xe9rence API"},"sidebar":"tutorialSidebar","previous":{"title":"Configuration avanc\xe9e","permalink":"/documentation/cron/configuration"},"next":{"title":"D\xe9pannage","permalink":"/documentation/cron/troubleshooting"}}');var t=r(4848),a=r(8453);const o={sidebar_position:4,title:"R\xe9f\xe9rence API"},i="\ud83d\udcda R\xe9f\xe9rence API",l={},d=[{value:"API Route",id:"api-route",level:2},{value:"<code>GET/POST /api/cron/update-monsters</code>",id:"getpost-apicronupdate-monsters",level:3},{value:"Headers",id:"headers",level:4},{value:"R\xe9ponse - Succ\xe8s (200)",id:"r\xe9ponse---succ\xe8s-200",level:4},{value:"R\xe9ponse - Unauthorized (401)",id:"r\xe9ponse---unauthorized-401",level:4},{value:"R\xe9ponse - Erreur (500)",id:"r\xe9ponse---erreur-500",level:4},{value:"Exemple avec curl",id:"exemple-avec-curl",level:4},{value:"Exemple avec fetch",id:"exemple-avec-fetch",level:4},{value:"Hook <code>useAutoUpdateMonsters</code>",id:"hook-useautoupdatemonsters",level:2},{value:"Signature",id:"signature",level:3},{value:"Options",id:"options",level:3},{value:"Valeurs retourn\xe9es",id:"valeurs-retourn\xe9es",level:3},{value:"Type <code>UpdateResult</code>",id:"type-updateresult",level:3},{value:"Exemples d&#39;utilisation",id:"exemples-dutilisation",level:3},{value:"Basique",id:"basique",level:4},{value:"Avec options",id:"avec-options",level:4},{value:"D\xe9clenchement manuel",id:"d\xe9clenchement-manuel",level:4},{value:"Affichage du d\xe9lai",id:"affichage-du-d\xe9lai",level:4},{value:"Avec callback",id:"avec-callback",level:4},{value:"Composant <code>MonstersAutoUpdater</code>",id:"composant-monstersautoupdater",level:2},{value:"Props",id:"props",level:3},{value:"Exemple d&#39;utilisation",id:"exemple-dutilisation",level:3},{value:"\xc9tats des monstres",id:"\xe9tats-des-monstres",level:2},{value:"Logs",id:"logs",level:2},{value:"Logs frontend",id:"logs-frontend",level:3},{value:"Logs API/Backend",id:"logs-apibackend",level:3},{value:"Variables d&#39;environnement",id:"variables-denvironnement",level:2},{value:"Constantes",id:"constantes",level:2},{value:"\ud83d\udd17 Voir aussi",id:"-voir-aussi",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"-r\xe9f\xe9rence-api",children:"\ud83d\udcda R\xe9f\xe9rence API"})}),"\n",(0,t.jsx)(n.p,{children:"Documentation technique compl\xe8te du syst\xe8me de mise \xe0 jour automatique."}),"\n",(0,t.jsx)(n.h2,{id:"api-route",children:"API Route"}),"\n",(0,t.jsx)(n.h3,{id:"getpost-apicronupdate-monsters",children:(0,t.jsx)(n.code,{children:"GET/POST /api/cron/update-monsters"})}),"\n",(0,t.jsx)(n.p,{children:"Met \xe0 jour al\xe9atoirement les \xe9tats de tous les monstres dans la base de donn\xe9es."}),"\n",(0,t.jsx)(n.h4,{id:"headers",children:"Headers"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"Content-Type: application/json\r\nAuthorization: Bearer <CRON_SECRET_TOKEN>  (optionnel)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"r\xe9ponse---succ\xe8s-200",children:"R\xe9ponse - Succ\xe8s (200)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": true,\r\n  "updated": 5,\r\n  "timestamp": "2025-10-29T12:34:56.789Z",\r\n  "duration": 234,\r\n  "details": [\r\n    {\r\n      "id": "507f1f77bcf86cd799439011",\r\n      "oldState": "hungry",\r\n      "newState": "sleepy"\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"r\xe9ponse---unauthorized-401",children:"R\xe9ponse - Unauthorized (401)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "error": "Unauthorized",\r\n  "message": "Invalid or missing token"\r\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"r\xe9ponse---erreur-500",children:"R\xe9ponse - Erreur (500)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "success": false,\r\n  "error": "Internal server error",\r\n  "message": "Connection to database failed",\r\n  "timestamp": "2025-10-29T12:34:56.789Z",\r\n  "duration": 123\r\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"exemple-avec-curl",children:"Exemple avec curl"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Sans authentification\r\ncurl http://localhost:3000/api/cron/update-monsters\r\n\r\n# Avec authentification\r\ncurl -H "Authorization: Bearer votre_token" \\\r\n  http://localhost:3000/api/cron/update-monsters\r\n\r\n# Avec jq pour formater\r\ncurl -s http://localhost:3000/api/cron/update-monsters | jq\n'})}),"\n",(0,t.jsx)(n.h4,{id:"exemple-avec-fetch",children:"Exemple avec fetch"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const response = await fetch('/api/cron/update-monsters', {\r\n  method: 'POST',\r\n  headers: {\r\n    'Authorization': `Bearer ${process.env.NEXT_PUBLIC_CRON_SECRET_TOKEN}`\r\n  }\r\n})\r\n\r\nconst data = await response.json()\r\nconsole.log(data)\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"hook-useautoupdatemonsters",children:["Hook ",(0,t.jsx)(n.code,{children:"useAutoUpdateMonsters"})]}),"\n",(0,t.jsx)(n.p,{children:"Hook React pour g\xe9rer les mises \xe0 jour automatiques avec intervalles al\xe9atoires."}),"\n",(0,t.jsx)(n.h3,{id:"signature",children:"Signature"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"function useAutoUpdateMonsters(\r\n  options?: UseAutoUpdateMonstersOptions\r\n): {\r\n  trigger: () => Promise<void>\r\n  isUpdating: boolean\r\n  lastUpdate: UpdateResult | null\r\n  updateCount: number\r\n  nextUpdateIn: number | null\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface UseAutoUpdateMonstersOptions {\r\n  /** Intervalle minimum en millisecondes (d\xe9faut: 60000) */\r\n  minInterval?: number\r\n  \r\n  /** Intervalle maximum en millisecondes (d\xe9faut: 180000) */\r\n  maxInterval?: number\r\n  \r\n  /** Active/d\xe9sactive les mises \xe0 jour (d\xe9faut: true) */\r\n  enabled?: boolean\r\n  \r\n  /** Callback appel\xe9 apr\xe8s chaque mise \xe0 jour */\r\n  onUpdate?: (result: UpdateResult) => void\r\n  \r\n  /** Active les logs dans la console (d\xe9faut: true) */\r\n  verbose?: boolean\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"valeurs-retourn\xe9es",children:"Valeurs retourn\xe9es"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface ReturnValue {\r\n  /** Fonction pour d\xe9clencher manuellement une mise \xe0 jour */\r\n  trigger: () => Promise<void>\r\n  \r\n  /** Indique si une mise \xe0 jour est en cours */\r\n  isUpdating: boolean\r\n  \r\n  /** R\xe9sultat de la derni\xe8re mise \xe0 jour */\r\n  lastUpdate: UpdateResult | null\r\n  \r\n  /** Nombre de mises \xe0 jour effectu\xe9es */\r\n  updateCount: number\r\n  \r\n  /** D\xe9lai en ms avant la prochaine mise \xe0 jour */\r\n  nextUpdateIn: number | null\r\n}\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"type-updateresult",children:["Type ",(0,t.jsx)(n.code,{children:"UpdateResult"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface UpdateResult {\r\n  success: boolean\r\n  updated?: number\r\n  timestamp?: string\r\n  duration?: number\r\n  error?: string\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"exemples-dutilisation",children:"Exemples d'utilisation"}),"\n",(0,t.jsx)(n.h4,{id:"basique",children:"Basique"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"'use client'\r\n\r\nimport { useAutoUpdateMonsters } from '@/hooks/use-auto-update-monsters'\r\n\r\nexport function MyComponent() {\r\n  const { isUpdating, lastUpdate, updateCount } = useAutoUpdateMonsters()\r\n\r\n  return (\r\n    <div>\r\n      <p>Mises \xe0 jour effectu\xe9es : {updateCount}</p>\r\n      <p>Statut : {isUpdating ? 'En cours...' : 'En attente'}</p>\r\n    </div>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"avec-options",children:"Avec options"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { trigger, isUpdating, lastUpdate, nextUpdateIn } = useAutoUpdateMonsters({\r\n  minInterval: 30000,\r\n  maxInterval: 120000,\r\n  enabled: true,\r\n  verbose: true,\r\n  onUpdate: (result) => {\r\n    if (result.success) {\r\n      console.log(`\u2705 ${result.updated} monstres mis \xe0 jour`)\r\n    }\r\n  }\r\n})\n"})}),"\n",(0,t.jsx)(n.h4,{id:"d\xe9clenchement-manuel",children:"D\xe9clenchement manuel"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { trigger, isUpdating } = useAutoUpdateMonsters({\r\n  enabled: false // Pas d'auto-update\r\n})\r\n\r\nreturn (\r\n  <button onClick={trigger} disabled={isUpdating}>\r\n    {isUpdating ? 'Mise \xe0 jour...' : 'Mettre \xe0 jour maintenant'}\r\n  </button>\r\n)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"affichage-du-d\xe9lai",children:"Affichage du d\xe9lai"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { nextUpdateIn } = useAutoUpdateMonsters()\r\n\r\nreturn (\r\n  <div>\r\n    {nextUpdateIn && (\r\n      <p>Prochaine mise \xe0 jour dans {Math.round(nextUpdateIn / 1000)}s</p>\r\n    )}\r\n  </div>\r\n)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"avec-callback",children:"Avec callback"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const [stats, setStats] = useState({ total: 0, monsters: 0 })\r\n\r\nuseAutoUpdateMonsters({\r\n  minInterval: 60000,\r\n  maxInterval: 180000,\r\n  onUpdate: (result) => {\r\n    if (result.success) {\r\n      setStats({\r\n        total: stats.total + 1,\r\n        monsters: stats.monsters + (result.updated || 0)\r\n      })\r\n    }\r\n  }\r\n})\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"composant-monstersautoupdater",children:["Composant ",(0,t.jsx)(n.code,{children:"MonstersAutoUpdater"})]}),"\n",(0,t.jsx)(n.p,{children:"Composant React pour int\xe9grer facilement les mises \xe0 jour automatiques."}),"\n",(0,t.jsx)(n.h3,{id:"props",children:"Props"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface MonstersAutoUpdaterProps {\r\n  minInterval?: number\r\n  maxInterval?: number\r\n  enabled?: boolean\r\n  verbose?: boolean\r\n  showIndicator?: boolean\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"exemple-dutilisation",children:"Exemple d'utilisation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:'title="src/app/layout.tsx"',children:"import { MonstersAutoUpdater } from '@/components/monsters/auto-updater'\r\n\r\nexport default function RootLayout({ children }) {\r\n  return (\r\n    <html>\r\n      <body>\r\n        {children}\r\n        <MonstersAutoUpdater\r\n          minInterval={60000}\r\n          maxInterval={180000}\r\n          enabled\r\n          verbose\r\n          showIndicator={false}\r\n        />\r\n      </body>\r\n    </html>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\xe9tats-des-monstres",children:"\xc9tats des monstres"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"type MonsterState = 'sad' | 'angry' | 'hungry' | 'sleepy'\r\n\r\nconst MONSTER_STATES: readonly MonsterState[] = [\r\n  'sad',    // \ud83d\ude22 Triste\r\n  'angry',  // \ud83d\ude20 En col\xe8re\r\n  'hungry', // \ud83d\ude0b Affam\xe9\r\n  'sleepy'  // \ud83d\ude34 Endormi\r\n]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"logs",children:"Logs"}),"\n",(0,t.jsx)(n.p,{children:"Tous les logs sont pr\xe9fix\xe9s pour faciliter le filtrage :"}),"\n",(0,t.jsx)(n.h3,{id:"logs-frontend",children:"Logs frontend"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[TIMESTAMP] [AUTO-UPDATE] [LEVEL] message\n"})}),"\n",(0,t.jsx)(n.p,{children:"Exemples :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[2025-10-29T...] [AUTO-UPDATE] \ud83d\ude80 D\xe9marrage des mises \xe0 jour automatiques (intervalle al\xe9atoire: 1-3 min)\r\n[2025-10-29T...] [AUTO-UPDATE] \ud83d\udd04 D\xe9clenchement mise \xe0 jour des monstres...\r\n[2025-10-29T...] [AUTO-UPDATE] \u2705 Monstres mis \xe0 jour avec succ\xe8s\r\n[2025-10-29T...] [AUTO-UPDATE] \u23f0 Prochaine mise \xe0 jour dans 142s (2 min)\r\n[2025-10-29T...] [AUTO-UPDATE] \u274c Erreur lors de la mise \xe0 jour\n"})}),"\n",(0,t.jsx)(n.h3,{id:"logs-apibackend",children:"Logs API/Backend"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[TIMESTAMP] [CRON-UPDATE-MONSTERS] [LEVEL] message\n"})}),"\n",(0,t.jsx)(n.p,{children:"Exemples :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"[2025-10-29T...] [CRON-UPDATE-MONSTERS] [INFO] \ud83d\ude80 D\xe9marrage de la mise \xe0 jour des monstres...\r\n[2025-10-29T...] [CRON-UPDATE-MONSTERS] [INFO] \ud83d\udd0c Connexion \xe0 MongoDB...\r\n[2025-10-29T...] [CRON-UPDATE-MONSTERS] [INFO] \u2705 Connect\xe9 \xe0 MongoDB\r\n[2025-10-29T...] [CRON-UPDATE-MONSTERS] [INFO] \ud83d\udcca 5 monstre(s) trouv\xe9(s)\r\n[2025-10-29T...] [CRON-UPDATE-MONSTERS] [INFO] \u2728 Monstre 507f... \u2192 hungry => sleepy\r\n[2025-10-29T...] [CRON-UPDATE-MONSTERS] [INFO] \u2705 Mise \xe0 jour termin\xe9e: 5 monstre(s) en 223ms\r\n[2025-10-29T...] [CRON-UPDATE-MONSTERS] [ERROR] \u274c Erreur lors de la mise \xe0 jour des monstres\n"})}),"\n",(0,t.jsx)(n.h2,{id:"variables-denvironnement",children:"Variables d'environnement"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-env",children:"# Token secret serveur (optionnel)\r\nCRON_SECRET_TOKEN=your_secret_token\r\n\r\n# Token public client (optionnel, doit \xeatre identique)\r\nNEXT_PUBLIC_CRON_SECRET_TOKEN=your_secret_token\n"})}),"\n",(0,t.jsx)(n.h2,{id:"constantes",children:"Constantes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Valeurs par d\xe9faut\r\nconst DEFAULT_MIN_INTERVAL = 60000  // 1 minute\r\nconst DEFAULT_MAX_INTERVAL = 180000 // 3 minutes\r\nconst DEFAULT_ENABLED = true\r\nconst DEFAULT_VERBOSE = true\r\nconst DEFAULT_SHOW_INDICATOR = false\r\n\r\n// Limites\r\nconst MAX_DURATION = 60 // Dur\xe9e max d'ex\xe9cution API (secondes)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-voir-aussi",children:"\ud83d\udd17 Voir aussi"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/documentation/cron/configuration",children:"Configuration avanc\xe9e"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/documentation/cron/troubleshooting",children:"D\xe9pannage"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/documentation/cron/quickstart",children:"Guide de d\xe9marrage"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var s=r(6540);const t={},a=s.createContext(t);function o(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);