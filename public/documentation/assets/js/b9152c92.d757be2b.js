"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[790],{2764:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"authentication/auth-system","title":"Syst\xe8me d\'Authentification","description":"Documentation compl\xe8te du syst\xe8me d\'authentification bas\xe9 sur Better Auth dans Tamagotcho.","source":"@site/docs/authentication/auth-system.md","sourceDirName":"authentication","slug":"/authentication/auth-system","permalink":"/documentation/authentication/auth-system","draft":false,"unlisted":false,"editUrl":"https://github.com/RiusmaX/tamagotcho/tree/master/documentation/docs/authentication/auth-system.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Syst\xe8me de Monstres","permalink":"/documentation/monsters/monster-system"},"next":{"title":"Vue d\'ensemble","permalink":"/documentation/cron/overview"}}');var t=r(4848),s=r(8453);const o={sidebar_position:1},l="Syst\xe8me d'Authentification",a={},c=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Configuration Server-Side",id:"configuration-server-side",level:2},{value:"Fichier: src/lib/auth.ts",id:"fichier-srclibauthts",level:3},{value:"Options de configuration",id:"options-de-configuration",level:3},{value:"Configuration Client-Side",id:"configuration-client-side",level:2},{value:"Fichier: src/lib/auth-client.ts",id:"fichier-srclibauth-clientts",level:3},{value:"Hooks et fonctions disponibles",id:"hooks-et-fonctions-disponibles",level:3},{value:"Variables d&#39;environnement",id:"variables-denvironnement",level:2},{value:"Fichier: .env.local",id:"fichier-envlocal",level:3},{value:"Configuration GitHub OAuth",id:"configuration-github-oauth",level:3},{value:"Route API d&#39;authentification",id:"route-api-dauthentification",level:2},{value:"Fichier: src/app/api/auth/[...all]/route.ts",id:"fichier-srcappapiauthallroutets",level:3},{value:"Composants de formulaires",id:"composants-de-formulaires",level:2},{value:"SignInForm",id:"signinform",level:3},{value:"SignUpForm",id:"signupform",level:3},{value:"GitHub OAuth Button",id:"github-oauth-button",level:3},{value:"Protection des routes",id:"protection-des-routes",level:2},{value:"Server-Side (Server Components)",id:"server-side-server-components",level:3},{value:"Client-Side (Client Components)",id:"client-side-client-components",level:3},{value:"Hook useSession",id:"hook-usesession",level:2},{value:"Utilisation basique",id:"utilisation-basique",level:3},{value:"Structure de l&#39;objet session",id:"structure-de-lobjet-session",level:3},{value:"Server Actions avec authentification",id:"server-actions-avec-authentification",level:2},{value:"D\xe9connexion",id:"d\xe9connexion",level:2},{value:"Bouton de d\xe9connexion",id:"bouton-de-d\xe9connexion",level:3},{value:"Collections MongoDB",id:"collections-mongodb",level:2},{value:"users",id:"users",level:3},{value:"sessions",id:"sessions",level:3},{value:"accounts",id:"accounts",level:3},{value:"S\xe9curit\xe9",id:"s\xe9curit\xe9",level:2},{value:"Meilleures pratiques",id:"meilleures-pratiques",level:3},{value:"Variables \xe0 ne JAMAIS exposer",id:"variables-\xe0-ne-jamais-exposer",level:3},{value:"Validation des formulaires",id:"validation-des-formulaires",level:2},{value:"Avec Zod (recommand\xe9)",id:"avec-zod-recommand\xe9",level:3},{value:"Gestion des erreurs",id:"gestion-des-erreurs",level:2},{value:"Tests recommand\xe9s",id:"tests-recommand\xe9s",level:2},{value:"Ressources",id:"ressources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"syst\xe8me-dauthentification",children:"Syst\xe8me d'Authentification"})}),"\n",(0,t.jsxs)(n.p,{children:["Documentation compl\xe8te du syst\xe8me d'authentification bas\xe9 sur ",(0,t.jsx)(n.strong,{children:"Better Auth"})," dans Tamagotcho."]}),"\n",(0,t.jsx)(n.h2,{id:"vue-densemble",children:"Vue d'ensemble"}),"\n",(0,t.jsxs)(n.p,{children:["Tamagotcho utilise ",(0,t.jsx)(n.strong,{children:"Better Auth 1.3.24"}),", une solution d'authentification moderne et s\xe9curis\xe9e pour Next.js, avec support de :"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Email/Password (connexion classique)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 GitHub OAuth (connexion sociale)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 MongoDB comme base de donn\xe9es"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Sessions s\xe9curis\xe9es"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Protection des routes"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502        Client (Browser)                 \u2502\r\n\u2502  - auth-client.ts (Better Auth Client)  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n               \u2502 HTTP Requests\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502        Server (Next.js API)             \u2502\r\n\u2502  - auth.ts (Better Auth Server)         \u2502\r\n\u2502  - API Route: /api/auth/[...all]        \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n               \u2502 Adapter\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502        Database (MongoDB)               \u2502\r\n\u2502  - users collection                     \u2502\r\n\u2502  - sessions collection                  \u2502\r\n\u2502  - accounts collection                  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-server-side",children:"Configuration Server-Side"}),"\n",(0,t.jsx)(n.h3,{id:"fichier-srclibauthts",children:"Fichier: src/lib/auth.ts"}),"\n",(0,t.jsx)(n.p,{children:"Configuration de Better Auth c\xf4t\xe9 serveur."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { betterAuth } from 'better-auth'\r\nimport { mongodbAdapter } from 'better-auth/adapters/mongodb'\r\nimport { client } from '@/db'\r\n\r\nexport const auth = betterAuth({\r\n  database: mongodbAdapter(\r\n    client.db(process.env.MONGODB_DATABASE_NAME as string)\r\n  ),\r\n  emailAndPassword: {\r\n    enabled: true\r\n  },\r\n  socialProviders: {\r\n    github: {\r\n      enabled: true,\r\n      clientId: process.env.GITHUB_CLIENT_ID as string,\r\n      clientSecret: process.env.GITHUB_CLIENT_SECRET as string\r\n    }\r\n  }\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"options-de-configuration",children:"Options de configuration"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Option"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Valeur"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"database"})}),(0,t.jsx)(n.td,{children:"Adapter MongoDB"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"mongodbAdapter(client.db(...))"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"emailAndPassword.enabled"})}),(0,t.jsx)(n.td,{children:"Activer email/password"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"socialProviders.github.enabled"})}),(0,t.jsx)(n.td,{children:"Activer GitHub OAuth"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"socialProviders.github.clientId"})}),(0,t.jsx)(n.td,{children:"ID client GitHub"}),(0,t.jsxs)(n.td,{children:["Depuis ",(0,t.jsx)(n.code,{children:".env"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"socialProviders.github.clientSecret"})}),(0,t.jsx)(n.td,{children:"Secret client GitHub"}),(0,t.jsxs)(n.td,{children:["Depuis ",(0,t.jsx)(n.code,{children:".env"})]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"configuration-client-side",children:"Configuration Client-Side"}),"\n",(0,t.jsx)(n.h3,{id:"fichier-srclibauth-clientts",children:"Fichier: src/lib/auth-client.ts"}),"\n",(0,t.jsx)(n.p,{children:"Client d'authentification pour le navigateur."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { createAuthClient } from 'better-auth/react'\r\n\r\nexport const authClient = createAuthClient({\r\n  baseURL: process.env.NEXT_PUBLIC_APP_URL\r\n})\r\n\r\nexport const {\r\n  signIn,\r\n  signUp,\r\n  signOut,\r\n  useSession\r\n} = authClient\n"})}),"\n",(0,t.jsx)(n.h3,{id:"hooks-et-fonctions-disponibles",children:"Hooks et fonctions disponibles"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Fonction/Hook"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"signIn()"})}),(0,t.jsx)(n.td,{children:"Function"}),(0,t.jsx)(n.td,{children:"Connexion utilisateur"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"signUp()"})}),(0,t.jsx)(n.td,{children:"Function"}),(0,t.jsx)(n.td,{children:"Inscription utilisateur"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"signOut()"})}),(0,t.jsx)(n.td,{children:"Function"}),(0,t.jsx)(n.td,{children:"D\xe9connexion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"useSession()"})}),(0,t.jsx)(n.td,{children:"Hook"}),(0,t.jsx)(n.td,{children:"R\xe9cup\xe8re la session active"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"variables-denvironnement",children:"Variables d'environnement"}),"\n",(0,t.jsx)(n.h3,{id:"fichier-envlocal",children:"Fichier: .env.local"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# MongoDB\r\nMONGODB_URI="mongodb+srv://..."\r\nMONGODB_DATABASE_NAME="tamagotcho"\r\n\r\n# Better Auth\r\nNEXT_PUBLIC_APP_URL="http://localhost:3000"\r\n\r\n# GitHub OAuth (optionnel)\r\nGITHUB_CLIENT_ID="your_github_client_id"\r\nGITHUB_CLIENT_SECRET="your_github_client_secret"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-github-oauth",children:"Configuration GitHub OAuth"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Cr\xe9er une OAuth App sur GitHub"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Aller sur ",(0,t.jsx)(n.a,{href:"https://github.com/settings/developers",children:"GitHub Settings > Developer settings > OAuth Apps"})]}),"\n",(0,t.jsx)(n.li,{children:'Cliquer sur "New OAuth App"'}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Remplir les informations"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Application name"}),": Tamagotcho"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Homepage URL"}),": ",(0,t.jsx)(n.code,{children:"http://localhost:3000"})," (dev) ou votre URL de production"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authorization callback URL"}),": ",(0,t.jsx)(n.code,{children:"http://localhost:3000/api/auth/callback/github"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"R\xe9cup\xe9rer les credentials"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Copier le ",(0,t.jsx)(n.strong,{children:"Client ID"})]}),"\n",(0,t.jsxs)(n.li,{children:["G\xe9n\xe9rer et copier le ",(0,t.jsx)(n.strong,{children:"Client Secret"})]}),"\n",(0,t.jsxs)(n.li,{children:["Ajouter dans ",(0,t.jsx)(n.code,{children:".env.local"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"route-api-dauthentification",children:"Route API d'authentification"}),"\n",(0,t.jsx)(n.h3,{id:"fichier-srcappapiauthallroutets",children:"Fichier: src/app/api/auth/[...all]/route.ts"}),"\n",(0,t.jsx)(n.p,{children:"Route catch-all pour g\xe9rer toutes les requ\xeates d'authentification."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { auth } from '@/lib/auth'\r\nimport { toNextJsHandler } from 'better-auth/next-js'\r\n\r\nexport const { GET, POST } = toNextJsHandler(auth)\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"Routes g\xe9n\xe9r\xe9es automatiquement",type:"info",children:[(0,t.jsx)(n.p,{children:"Better Auth g\xe9n\xe8re automatiquement les routes suivantes :"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"POST /api/auth/sign-in"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"POST /api/auth/sign-up"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"POST /api/auth/sign-out"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"GET /api/auth/callback/github"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"GET /api/auth/session"})}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"composants-de-formulaires",children:"Composants de formulaires"}),"\n",(0,t.jsx)(n.h3,{id:"signinform",children:"SignInForm"}),"\n",(0,t.jsx)(n.p,{children:"Formulaire de connexion avec email/password."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { signIn } from '@/lib/auth-client'\r\nimport { Button, Input } from '@/components'\r\n\r\nexport function SignInForm() {\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault()\r\n    setLoading(true)\r\n\r\n    try {\r\n      await signIn.email({\r\n        email,\r\n        password,\r\n        callbackURL: '/dashboard'\r\n      })\r\n    } catch (error) {\r\n      console.error('Erreur de connexion:', error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <Input\r\n        type=\"email\"\r\n        placeholder=\"Email\"\r\n        value={email}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n        required\r\n      />\r\n      <Input\r\n        type=\"password\"\r\n        placeholder=\"Mot de passe\"\r\n        value={password}\r\n        onChange={(e) => setPassword(e.target.value)}\r\n        required\r\n      />\r\n      <Button type=\"submit\" disabled={loading}>\r\n        {loading ? 'Connexion...' : 'Se connecter'}\r\n      </Button>\r\n    </form>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"signupform",children:"SignUpForm"}),"\n",(0,t.jsx)(n.p,{children:"Formulaire d'inscription."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { signUp } from '@/lib/auth-client'\r\nimport { Button, Input } from '@/components'\r\n\r\nexport function SignUpForm() {\r\n  const [name, setName] = useState('')\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault()\r\n    setLoading(true)\r\n\r\n    try {\r\n      await signUp.email({\r\n        name,\r\n        email,\r\n        password,\r\n        callbackURL: '/dashboard'\r\n      })\r\n    } catch (error) {\r\n      console.error('Erreur d\\'inscription:', error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <Input\r\n        type=\"text\"\r\n        placeholder=\"Nom\"\r\n        value={name}\r\n        onChange={(e) => setName(e.target.value)}\r\n        required\r\n      />\r\n      <Input\r\n        type=\"email\"\r\n        placeholder=\"Email\"\r\n        value={email}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n        required\r\n      />\r\n      <Input\r\n        type=\"password\"\r\n        placeholder=\"Mot de passe\"\r\n        value={password}\r\n        onChange={(e) => setPassword(e.target.value)}\r\n        required\r\n      />\r\n      <Button type=\"submit\" disabled={loading}>\r\n        {loading ? 'Inscription...' : 'S\\'inscrire'}\r\n      </Button>\r\n    </form>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"github-oauth-button",children:"GitHub OAuth Button"}),"\n",(0,t.jsx)(n.p,{children:"Bouton de connexion via GitHub."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { signIn } from '@/lib/auth-client'\r\nimport { Button } from '@/components'\r\n\r\nexport function GitHubSignInButton() {\r\n  const handleGitHubSignIn = async () => {\r\n    await signIn.social({\r\n      provider: 'github',\r\n      callbackURL: '/dashboard'\r\n    })\r\n  }\r\n\r\n  return (\r\n    <Button onClick={handleGitHubSignIn} variant=\"outline\">\r\n      <GitHubIcon /> Continuer avec GitHub\r\n    </Button>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"protection-des-routes",children:"Protection des routes"}),"\n",(0,t.jsx)(n.h3,{id:"server-side-server-components",children:"Server-Side (Server Components)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { auth } from '@/lib/auth'\r\nimport { redirect } from 'next/navigation'\r\n\r\nexport default async function DashboardPage() {\r\n  const session = await auth()\r\n\r\n  if (!session?.user) {\r\n    redirect('/sign-in')\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h1>Bienvenue {session.user.name}</h1>\r\n      {/* Contenu prot\xe9g\xe9 */}\r\n    </div>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"client-side-client-components",children:"Client-Side (Client Components)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { useSession } from '@/lib/auth-client'\r\nimport { redirect } from 'next/navigation'\r\nimport { useEffect } from 'react'\r\n\r\nexport function ProtectedComponent() {\r\n  const { data: session, isPending } = useSession()\r\n\r\n  useEffect(() => {\r\n    if (!isPending && !session) {\r\n      redirect('/sign-in')\r\n    }\r\n  }, [session, isPending])\r\n\r\n  if (isPending) {\r\n    return <div>Chargement...</div>\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <p>Contenu prot\xe9g\xe9 pour {session.user.name}</p>\r\n    </div>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"hook-usesession",children:"Hook useSession"}),"\n",(0,t.jsx)(n.h3,{id:"utilisation-basique",children:"Utilisation basique"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { useSession } from '@/lib/auth-client'\r\n\r\nexport function UserProfile() {\r\n  const { data: session, isPending } = useSession()\r\n\r\n  if (isPending) {\r\n    return <div>Chargement...</div>\r\n  }\r\n\r\n  if (!session) {\r\n    return <div>Non connect\xe9</div>\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <img src={session.user.image} alt={session.user.name} />\r\n      <h2>{session.user.name}</h2>\r\n      <p>{session.user.email}</p>\r\n    </div>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"structure-de-lobjet-session",children:"Structure de l'objet session"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface Session {\r\n  user: {\r\n    id: string\r\n    name: string\r\n    email: string\r\n    image?: string\r\n  }\r\n  expiresAt: Date\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"server-actions-avec-authentification",children:"Server Actions avec authentification"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use server'\r\n\r\nimport { auth } from '@/lib/auth'\r\nimport { MonsterModel } from '@/db/models/monster.model'\r\n\r\nexport async function createMonster(name: string) {\r\n  // V\xe9rification de l'authentification\r\n  const session = await auth()\r\n  \r\n  if (!session?.user?.id) {\r\n    throw new Error('Non authentifi\xe9')\r\n  }\r\n\r\n  // Action prot\xe9g\xe9e\r\n  const monster = await MonsterModel.create({\r\n    name,\r\n    ownerId: session.user.id,\r\n    // ...\r\n  })\r\n\r\n  return monster\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"d\xe9connexion",children:"D\xe9connexion"}),"\n",(0,t.jsx)(n.h3,{id:"bouton-de-d\xe9connexion",children:"Bouton de d\xe9connexion"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { signOut } from '@/lib/auth-client'\r\nimport { Button } from '@/components'\r\n\r\nexport function SignOutButton() {\r\n  const handleSignOut = async () => {\r\n    await signOut({\r\n      callbackURL: '/'\r\n    })\r\n  }\r\n\r\n  return (\r\n    <Button onClick={handleSignOut} variant=\"ghost\">\r\n      Se d\xe9connecter\r\n    </Button>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"collections-mongodb",children:"Collections MongoDB"}),"\n",(0,t.jsx)(n.p,{children:"Better Auth cr\xe9e automatiquement les collections suivantes :"}),"\n",(0,t.jsx)(n.h3,{id:"users",children:"users"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "_id": "ObjectId",\r\n  "name": "John Doe",\r\n  "email": "john@example.com",\r\n  "emailVerified": false,\r\n  "image": "https://...",\r\n  "createdAt": "2024-01-01T00:00:00.000Z",\r\n  "updatedAt": "2024-01-01T00:00:00.000Z"\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"sessions",children:"sessions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "_id": "ObjectId",\r\n  "userId": "user_id",\r\n  "expiresAt": "2024-02-01T00:00:00.000Z",\r\n  "token": "session_token",\r\n  "ipAddress": "192.168.1.1",\r\n  "userAgent": "Mozilla/5.0..."\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"accounts",children:"accounts"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "_id": "ObjectId",\r\n  "userId": "user_id",\r\n  "providerId": "github",\r\n  "providerUserId": "github_user_id",\r\n  "accessToken": "...",\r\n  "refreshToken": "..."\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"s\xe9curit\xe9",children:"S\xe9curit\xe9"}),"\n",(0,t.jsx)(n.h3,{id:"meilleures-pratiques",children:"Meilleures pratiques"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Jamais de secrets c\xf4t\xe9 client"})," : ",(0,t.jsx)(n.code,{children:"GITHUB_CLIENT_SECRET"})," uniquement dans ",(0,t.jsx)(n.code,{children:".env.local"})]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"HTTPS en production"})," : Toujours utiliser HTTPS pour les requ\xeates d'auth"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Validation serveur"})," : Toujours v\xe9rifier la session c\xf4t\xe9 serveur"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Expiration de session"})," : Sessions expir\xe9es automatiquement"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Protection CSRF"})," : G\xe9r\xe9e automatiquement par Better Auth"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"variables-\xe0-ne-jamais-exposer",children:"Variables \xe0 ne JAMAIS exposer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# \u274c NE JAMAIS pr\xe9fixer avec NEXT_PUBLIC_\r\nGITHUB_CLIENT_SECRET="secret"\r\nMONGODB_URI="mongodb+srv://..."\r\n\r\n# \u2705 OK pour le client\r\nNEXT_PUBLIC_APP_URL="https://..."\n'})}),"\n",(0,t.jsx)(n.h2,{id:"validation-des-formulaires",children:"Validation des formulaires"}),"\n",(0,t.jsx)(n.h3,{id:"avec-zod-recommand\xe9",children:"Avec Zod (recommand\xe9)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { z } from 'zod'\r\n\r\nconst signUpSchema = z.object({\r\n  name: z.string().min(2, 'Le nom doit contenir au moins 2 caract\xe8res'),\r\n  email: z.string().email('Email invalide'),\r\n  password: z.string().min(8, 'Le mot de passe doit contenir au moins 8 caract\xe8res')\r\n})\r\n\r\nexport function SignUpForm() {\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault()\r\n    \r\n    // Validation\r\n    const result = signUpSchema.safeParse({ name, email, password })\r\n    \r\n    if (!result.success) {\r\n      console.error(result.error.errors)\r\n      return\r\n    }\r\n    \r\n    // Inscription\r\n    await signUp.email(result.data)\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"gestion-des-erreurs",children:"Gestion des erreurs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { signIn } from '@/lib/auth-client'\r\n\r\nexport function SignInForm() {\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const handleSubmit = async (e: FormEvent) => {\r\n    e.preventDefault()\r\n    setError(null)\r\n\r\n    try {\r\n      await signIn.email({ email, password })\r\n    } catch (err) {\r\n      if (err instanceof Error) {\r\n        setError(err.message)\r\n      } else {\r\n        setError('Une erreur est survenue')\r\n      }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      {error && <div className=\"error\">{error}</div>}\r\n      {/* Champs de formulaire */}\r\n    </form>\r\n  )\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"tests-recommand\xe9s",children:"Tests recommand\xe9s"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"describe('Authentication', () => {\r\n  it('devrait connecter un utilisateur valide', async () => {\r\n    const result = await signIn.email({\r\n      email: 'test@example.com',\r\n      password: 'password123'\r\n    })\r\n    \r\n    expect(result.user).toBeDefined()\r\n    expect(result.user.email).toBe('test@example.com')\r\n  })\r\n\r\n  it('devrait rejeter un mot de passe invalide', async () => {\r\n    await expect(\r\n      signIn.email({\r\n        email: 'test@example.com',\r\n        password: 'wrong'\r\n      })\r\n    ).rejects.toThrow()\r\n  })\r\n})\n"})}),"\n",(0,t.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.better-auth.com",children:"Better Auth Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/settings/developers",children:"GitHub OAuth Apps"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/authentication",children:"Next.js Authentication"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.better-auth.com/docs/adapters/mongodb",children:"MongoDB Adapter"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);